/*! backbone.routefilter - v0.1.0 - 2012-12-13
* https://github.com/boazsender/backbone.routefilter
* Copyright (c) 2012 Boaz Sender; Licensed MIT */
(function(e,t){var n=function(e){var t={},n=e.match(/[^?]*\?(.*)/),r=/(?:^|&)([^&=]*)=?([^&]*)/g;return n?(n[1].replace(r,function(e,n,r){n&&(t[decodeURIComponent(n)]=decodeURIComponent(r))}),t):t},r=e.History.prototype.getHash,i=e.History.prototype.getFragment,s=e.History.prototype.navigate;t.extend(e.History.prototype,{_processHash:function(e){var t=e.match(/^(.*)\?/);return t?t[1]:e},getHash:function(){return this._processHash(r.apply(this,arguments))},getFragment:function(){return this._processHash(i.apply(this,arguments))},navigate:function(r,i){if(!e.History.started)return!1;if(!i||i===!0)i={trigger:i};var o=t(n(r)),u=n(window.location.href);if(this._wantsHashChange&&!o.isEqual({})&&!o.isEqual(u)){this.fragment=this.getFragment(r),this._updateHash(window.location,r,i.replace),this._updateIframeHash(r),i.trigger&&this.loadUrl(r);return}s.apply(this,arguments)},_updateIframeHash:function(e){if(this.iframe)return;var t=this.getHash(this.iframe);this.getFragment(e)!==this.getFragment(t)&&(options.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,options.replace))}});var o=e.Router.prototype.route,u=function(){};t.extend(e.Router.prototype,{before:u,after:u,route:function(e,r,i){i||(i=this[r]);var s=t.bind(function(){var e=n(window.location.hash),s={param:e,name:r},o=t(arguments).toArray().concat(s);if(this.before.apply(this,o)===!1)return;i&&i.apply(this,o),this.after.apply(this,o)},this);return o.call(this,e,r,s)}})})(Backbone,_);